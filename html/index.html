<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Agility in Containers - adamkrieger.ca</title>

    <meta name="description" content="A framework for easily creating beautiful presentations using HTML">
    <meta name="author" content="Hakim El Hattab">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black_ak.css" id="theme">


    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <link rel="stylesheet" href="css/font-awesome.css">
    <!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->

    <link rel="stylesheet" href="css/ak-speaking.css">
</head>

<!-- Sources

https://blog.docker.com/2016/03/containers-are-not-vms/
-->

<body>

    <img id="aklogo" src="img/aklogo.png" />
    <div id="akinfo">
        <p><b>www.adamkrieger.ca</b><br /></p>
        <p><b><i class="fa fa-twitter"></i> @adamkrieger</b></p>
    </div>
    <img id="onlinelogo" src="img/Online_logo.png" />

    <div class="reveal">

        <!-- Any section element inside of this container is displayed as a slide -->
        <div class="slides">
            <section>
                <div id="titleslide">
                    <div id="sessionbanner">
                        <div id="logo">
                            <img src="img/PrDC_logo.png" />
                        </div>
                        <div id="sessiontitle">
                            <span>AGILITY IN CONTAINERS</span>
                            <br />
                            <br />
                            <span>ADAM KRIEGER</span>
                        </div>
                    </div>
                    <div id="sponsors">
                        <span>SPONSORS</span>
                        <img src="img/sponsors.png" />
                    </div>
                </div>
            </section>
            <section>
                <h1>Agility in Containers</h1>
                <h2>How Work Evolves with Docker</h2>
                <i class="icon ion-home"></i>
                <div style="width: 300px; padding-left: 100px; margin: auto">
                    <p style="text-align: left">
                        <small>by Adam Krieger</small>
                    </p>
                </div>
                <i class="fa fa-chrome"></i> <a href="https://www.adamkrieger.ca/talks/dockerworkflows">https://www.adamkrieger.ca/talks/dockerworkflows</a><br />
                <i class="fa fa-github"></i> <a href="https://github.com/adamkrieger/FSBetter">https://github.com/adamkrieger/FSBetter</a>
            </section>

            <section>
                <h4>Why Containers?</h4>
                    <table style="width: 80%">
                        <tr><td>Isolation</td><td><i>Confidence in a vacuum</i></td></tr>
                        <tr><td>Immutability</td><td><i>Starting from square v1.0</i></td></tr>
                        <tr><td>Security</td><td><i>Reduced complexity and variance</i></td></tr>
                        <tr><td>Intent</td><td><i>Why don't you just tell me the name of the movie you selected?</i></td></tr>
                    </table>
            </section>

            <section>
                <h4>What is a container</h4>
                <p>LXC Around since 2008</p>
                <p>(Solaris Zones in 2005)</p>
                <p>libcontainer around since docker .9 (2014)</p>
                <p>Operating-System-Level Virtualization - Kernel Reuse, not a full software computer. Container is supplied with its own process/network/file space, 
                    but reuses the kernel.</p>
                <p>This is a savings of resources, mainly of disk, second of memory, and a bit of CPU. (Always falling as new hardware comes out.)</p>
            </section>
            <!-- http://serverfault.com/questions/225719/so-really-what-is-the-overhead-of-virtualization-and-when-should-i-be-concerned -->

            <section>
                <h4>What is Docker?</h4>
                <p>Around since 2013</p>
                <p>Layer of abstraction and tooling for Linux Containers written in Go</p>
                <p>Process tree rooted at PID0</p>
                <p>Wealth of integration with existing automation tooling (ansible, Chef, Cloud, et al)</p>
            </section>

            <section>
                <h4>Delivery Pre-Docker!</h4>
                <p>Deploying on bare metal. Physical connections to the internet. Deploy with manual action, hands on keyboards and spreadsheets.</p>
                <p>Deploying on VMs. Logical connections to the internet. Deploy with scripts, automation, and repositories.</p>
                <p>Deploying with Containers. Back to bare metal, but isolated processes. Deploy with immutable images and throwaway containers.</p>
            </section>

            <section>
                <h4>Conway's Law for Infrastructure</h4>
                <p>The structure of an organization's products and services will correspond to the structural capabilities of that organization's infrastructure.</p>
            </section>

            <section>
                <h4>Meanwhile, in Application Development</h4>
                <p>N-Tier Apps: One app, one database, one UI. Lucky to see apps or databases broken by responsibility.</p>
                <p>SOA: Loosely-coupled apps, serving individual purposes. Storage on queues, caches, or an assortment of databases.</p>
                <p>Microservices: Services as small as is functionally appropriate. Denormalized and distributed data sources in service of user experience.</p>
            </section>

            <section>
                <h4>Docker Toolset</h4>
                <p>Docker Machine - For provisioning hosts</p>
                <p>Docker Engine - Build/Run Containers</p>
                <p>Docker Compose - For defining multi-container applications</p>
                <p>Docker Hub - Image repository</p>
                <p>Swarm Mode - Multi-host orchestration</p>
            </section>

            <section>
                <h4>Immutability, Images, LFS</h4>
                <p>Mechanism for reuse. Nothing needs to be stored twice, even if a downstream image/container mutates.</p>
            </section>

            <section>
                Docker Security
                Priviledged v unpriviledged containers (whether they run as root on the host)
            </section>
            
            <section>
                
                <section>
                    <h5>Form: Composition / Decomposition</h5>
<pre><code class="fs">// Tuple without Tuple&lt;int,int>
let point = 4, 5
let x, y = point

// Record
type person = { FirstName: string; LastName: string }
let amySmith = { FirstName = "Amy"; LastName = "Smith" }
let { LastName = smith } = amySmith
</code></pre>
                    <i>No need for GetHashCode() or Equals()!</i>
                </section>
                
                <section>
                    <h5 style="text-align: left">C# Types</h5>
                    <i>Everything's an Object!</i>
                    <h5 style="text-align: left">F# Types</h5>
                    <table style="width: 90%">
                        <tr><td>Types</td><td><i>Declare intent</i></td></tr>
                        <tr><td>Composition</td><td><i>Over construction</i></td></tr>
                        <tr><td>Safety</td><td><i>Lint the danger</i></td></tr>
                        <tr><td>Currying</td><td><i>Without heavy DSLs</i></td></tr>
                    </table>
                </section>
            </section>
            
            <section>
                <section>
                    <h3>Functions!</h3>
                    <table style="width: 90%">
                        <tr><td><pre><code class="fs">fun x = x + 2</code></pre></td><td><i>Lame joke alert.</i></td></tr>
                        <tr><td>Pattern Matching</td><td><i>Ditch the switch</i></td></tr>
                        <tr><td><pre><code class="fs">option 'a</code></pre></td><td><i>A friendly Monad</i></td></tr>
                        <tr><td><pre><code class="fs">thisFunc >> thatFunc</code></pre></td><td><i>Snap functions together</i></td></tr>
                    </table>
                </section>
                
                <section>
                    <h5>Func: F# Safety in 6 Lines</h5>
<pre><code class="fs" style="max-height: 500px">let printName input =
    match input with | Some cheese -> printfn "%s" cheese.Name
                     | None        -> printfn "%s" "Completely out."
    
let pickCheese id =
    List.tryFind (fun cheese -> cheese.Id = id)
    >> printName
</code></pre>
                </section>
                
            </section>
            
            <section>
                <section data-transition="fade">
                    <img src="img/feedbackloop.png"/>
                </section>
                
                <section data-transition="fade">
                    <img src="img/feedbackloop_accel.png"/>
                </section>
            </section>

            <section>
                <section>
                    <h3>Railway-oriented Programming!</h3>
                    <table style="width: 90%">
                        <tr><td><pre><code class="fs">bind</code></pre></td><td><i>Lightweight coupling</i></td></tr>
                        <tr><td><pre><code class="fs">choice</code></pre></td><td><i>What?! Another Monad?</i></td></tr>
                        <tr><td>Roll Forward</td><td><i>Ride the rails</i></td></tr>
                    </table>
                </section>
                
                <section>
                    <h5>Plug-in Validation</h5>
<pre><code class="fs" style="max-height: 500px">myBooking
|> idNotZero
|> bind actuallyGoingSomewhere
|> bind addPlanet
|> function
    | Success booking -> printfn "Have fun in %s!" booking.Destination
    | Failure error -> printfn "%s" error
</code></pre>
                </section>
                
                <section>
                    <h5>Start with one</h5>
<pre><code class="fs" style="max-height: 500px">type Booking = { Id: int;
                 Destination: string }
    
let idNotZero booking = 
    match booking.Id with
    | 0 -> None
    | id -> Some booking
    
let myBooking = { Id = 2;
              Destination = "France" }

myBooking
|> idNotZero
|> function
    | Some booking -> printfn "Have fun in %s!" booking.Destination
    | None -> printfn "%s" "Oops!"
</code></pre>
                </section>
                
                <section>
                    <h5>Add another</h5>
<pre><code class="fs" style="max-height: 500px">let idNotZero booking = 
    match booking.Id with
    | 0 -> None
    | id -> Some booking
    
let actuallyGoingSomewhere =
    function
    | None -> None
    | Some booking ->
        booking.Source = booking.Destination
        |> function
            | true -> None
            | false -> Some booking  
</code></pre>
                    <i>But design for N</i>
                </section>
                
                <section>
                    <h5>Option.bind</h5>
<pre><code class="fs" style="max-height: 500px">let idNotZero booking = 
    match booking.Id with
    | 0 -> None
    | id -> Some booking
    
let actuallyGoingSomewhere booking =
    booking.Source = booking.Destination
    |> function
       | true -> None
       | false -> Some booking
       
myBooking
|> idNotZero
|> Option.bind actuallyGoingSomewhere
|> Option.bind planetExists
|> function
    | Some booking -> printfn "Have fun in %s!" booking.Destination
    | None -> printfn "%s" "Oops!"
</code></pre>
                    <i>But which one failed?</i>
                </section>
                
                <section>
                    <h5>Custom 'switcher'</h5>
<pre><code class="fs" style="max-height: 500px">type Result<'TSuccess, 'TFailure> =
    | Success of 'TSuccess
    | Failure of 'TFailure 

let bind f = fun eitherInput ->
                match eitherInput with
                | Success x -> f x
                | Failure x -> Failure x
        
let idNotZero booking = match booking.Id with
                        | 0 -> Failure "Oops, the id is zero."
                        | id -> Success booking
    
myBooking
|> idNotZero
|> bind actuallyGoingSomewhere
|> bind addPlanet
|> function
    | Success booking -> printfn "Have fun in %s!" booking.Destination
    | Failure error -> printfn "%s" error
</code></pre>
                </section>
                
            </section>

            <section>
                <section>
                    <h2>C# / F# Interop</h2>
                    <p><i>Getting value without rewrites</i></p>
                </section>
                <section>
                    <h3>Bootstrapping the example</h3>
                    <pre><code class="cs" style="max-height: 500px" data-trim contenteditable>using System;

public enum PaymentType
{
    Cash, Visa, Mastercard, Chickens
}

public class Bill
{
    public DateTime DatePaid {get;set;}
    public decimal Amount {get;set;}
    public PaymentType TypeOfPayment {get;set;}    
}

public interface IBillProcessor
{
    void PayBill(int id, Bill bill);
}
</code></pre>
                </section>
                <section>
                    <h4>Existing Flow</h4>
                    <pre><code class="cs" style="max-height: 500px" data-trim contenteditable>#r "6.1_BillPay.dll"

public class BillProcessor : IBillProcessor
{
    public void PayBill(int id, Bill bill){
        Console.WriteLine(string.Format(
         "Paying bill {0}, paid with {1}, in the amount of ${2} on {3}.", 
         id, bill.TypeOfPayment, bill.Amount, bill.DatePaid));
    }
}

IBillProcessor billProcessor = new BillProcessor();

billProcessor.PayBill(
    24,
    new Bill(){ DatePaid = DateTime.Now,
                Amount = 13.28M,
                TypeOfPayment = PaymentType.Cash }
);
</code></pre>
                </section>
                <section>
                    <h4>Implementing a C# Interface in F#</h4>
                    <pre><code class="fs" style="max-height: 500px" data-trim contenteditable>module ReplacementBillPayProcessors
#r "6.1_BillPay.dll"

type BetterBillProcessor() =
    let calculateTax paymentMethod paymentAmount = 
        match paymentMethod with
        | PaymentType.Chickens -> paymentAmount * 1.17M
        | PaymentType.Mastercard
        | PaymentType.Visa
        | PaymentType.Cash -> paymentAmount * 1.05M

    interface IBillProcessor with
        member this.PayBill(id, bill) =
            let taxedAmount = calculateTax bill.TypeOfPayment bill.Amount
        
            printfn 
                "Paying %d in F#, with %A, in the amount of $%.2f on %A." 
                id bill.TypeOfPayment taxedAmount bill.DatePaid
</code></pre>
                </section>
                <section>
                    <h4>Using the F# Implementation from C#</h4>
                    <pre><code class="cs" style="max-height: 500px" data-trim contenteditable>#r "6.3_BillPayFs.dll"

IBillProcessor billProcessor = 
    new ReplacementBillPayProcessors.BetterBillProcessor();

billProcessor.PayBill(
    24,
    new Bill(){
        DatePaid = DateTime.Now,
        Amount = 13.28M,
        TypeOfPayment = PaymentType.Cash
    }
);
</code></pre>
                </section>
            </section>
            
            <section>
                <h2>Thank you!</h2>
<pre><code class="fs" style="max-height: 500px">let rec sortIter lt eq gt list pivot =
     match list with
     | [] -> lt, eq, gt
     | head::tail when head < pivot -> 
                                sortIter (head::lt) eq gt tail pivot
                                
     | head::tail when head > pivot -> 
                                sortIter lt eq (head::gt) tail pivot
                                
     | head::tail -> 
                                sortIter lt (head::eq) gt tail pivot
            
let rec qsort list = 
    match list with
    | []          -> []
    | pivot::tail -> let lt, eq, gt = sortIter [] [] [] tail pivot
                     List.collect id [ qsort lt; [pivot]; eq; qsort gt ]
</code></pre>
            </section>
        </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
        // Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.pack.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});
    </script>

</body>

</html>
